# Низкоуровневое использование MySQL (продвинутый)

В этом руководстве показано, как получить доступ к необработанному экземпляру подключения MySQL из [пакета `mysql`](https://www.npmjs.com/package/mysql).  Это полезно для получения доступа к низкоуровневым API, доступным только в самом необработанном клиенте. 

> Примечание. Многим приложениям Node.js/Sails, использующим MySQL, никогда не потребуется низкоуровневое использование, описанное здесь. Если вы обнаружите, что сталкиваетесь с ограничениями ORM, обычно существует обходной путь, который не требует написания кода для базовой базы данных. Даже в этом случае, если вы просто хотите использовать настраиваемые нативные SQL-запросы, не читайте дальше — вместо этого ознакомьтесь с [`sendNativeQuery()`](/documentation/reference/waterline-orm/datastores/send-native-query).
>
> Кроме того, прежде чем мы продолжим, убедитесь, что ваше хранилище данных настроено на использование функционирующей базы данных MySQL.

### Получить доступ к активному соединению MySQL

Чтобы получить активное соединение из пакета MySQL, вы можете вызвать метод [`.leaseConnection()`](/documentation/reference/waterline-orm/datastores/lease-connection) зарегистрированного объекта хранилища данных (RDI).

1. Получите зарегистрированный экземпляр хранилища данных для подключения:

```javascript
// Получает именованное хранилище данных
var rdi = sails.getDatastore('default');

// Получает хранилище данных, настроенное для конкретной модели
var rdi = Product.getDatastore();
```

2. Вызовите метод `leaseConnection()` для получения активного подключеня:

```javascript
rdi.leaseConnection(function(connection, proceed) {
  db.query('SELECT * from `user`;', function(err, results, fields) {
    if (err) {
      return proceed(err);
    }

    proceed(undefined, results);
  });
}, function(err, results) {
  // Здесь обработка результатов после закрытия соединения
})
```

### Получить доступ к низкоуровневому драйверу

Чтобы получить доступ к низкоуровневому драйверу и пакету MySQL в приложении Sails, вы можете получить их из зарегистрированного объекта хранилища данных (RDI).

1. Получите зарегистрированный экземпляр хранилища данных для подключения:

```javascript
// Получает именованное хранилище данных
var rdi = sails.getDatastore('default');

// Получает хранилище данных, настроенное для конкретной модели
var rdi = Product.getDatastore();
```

2. Получите драйвер из экземпляра хранилища данных, содержащего модуль MySQL.:

```javascript
var mysql = rdi.driver.mysql;
```

3. Теперь вы можете использовать модуль для создания собственных запросов и вызова других функций, встроенных в модуль MySQL:

```javascript
// Получает именованное хранилище данных
var rdi = sails.getDatastore('default');

// Захватывает модуль MySQL из экземпляра хранилища данных
var mysql = rdi.driver.mysql;

// Создает новое подключение
var connection = mysql.createConnection({
  host     : 'localhost',
  user     : 'root',
  password : 'password',
  database: 'example_database'
});

// Делает запрос и передает результаты
connection.query('SELECT * FROM posts')
  .stream({highWaterMark: 5})
  .pipe(...);
```

<docmeta name="displayName" value="Низкоуровневое использование MySQL (продвинутый)">
